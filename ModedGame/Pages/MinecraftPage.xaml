<!-- Updated MinecraftPage.xaml with Modrinth integration -->
<Page x:Class="ModedGame.Pages.MinecraftPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:ModedGame"
      mc:Ignorable="d" 
      d:DesignHeight="700" d:DesignWidth="1200"
      Title="MinecraftPage">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Top Section - File Selection -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="20" Background="#f5f5f5">
            <TextBlock x:Name="MCFileResult"
                       Text="Add your local mod files to game"
                       FontSize="12" 
                       VerticalAlignment="Center"
                       Margin="10,0"
                       Width="200"
                       Height="50"
                       FontWeight="Bold"
                       Foreground="Green"/>
            <StackPanel Orientation="Vertical" Margin="5">
                <TextBlock Text="Select the file type:" FontSize="12" Margin="0,0,0,5"/>
                <ComboBox x:Name="FileTypePicker" Width="120" Height="30"
                          ItemsSource="{Binding MCFileType}"
                          SelectedItem="{Binding SelectedType}"
                          DisplayMemberPath="Name"
                          SelectedValuePath="Id"/>
            </StackPanel>

            <Button x:Name="MCFile" Content="Select Local File" 
                    Style="{StaticResource SuccessButtonStyle}" 
                    Margin="15,10,10,5" 
                    Click="File_Click"/>

            <Button x:Name="LocalFolder" Content="Open MC Folder" 
                    Style="{StaticResource SuccessButtonStyle}" 
                    Margin="15,10,10,5" 
                    Click="OpenFolder_Click"/>

            <ComboBox
                x:Name="GameVersionPicker" Width="200" Height="30"
                Margin="700,10,10,5"
            ></ComboBox>
            <Button x:Name="StartMinecraft" Style="{StaticResource SuccessButtonStyle}"
                    Content="Play Minecraft"
                    FontSize="18" FontWeight="Bold"
                    Margin="15,10,10,5"
                    Click="LaunchSelectedVersion"
                    ></Button>
        </StackPanel>

        <Grid Grid.Row="1" Margin="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Search and Filters -->
            <Border Grid.Column="0" Background="#f8f9fa" Padding="15" Margin="0,0,10,0">
                <StackPanel>
                    <TextBlock Text="Browse Modrinth" FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>

                    <!-- Search Box -->
                    <TextBlock Text="Search:" Margin="0,0,0,5"/>
                    <TextBox x:Name="SearchBox" Height="30" Margin="0,0,0,10"/>

                    <!-- Category Filter -->
                    <TextBlock Text="Category:" Margin="0,0,0,5"/>
                    <ComboBox x:Name="CategoryFilter" Height="30" Margin="0,0,0,10">
                        <ComboBoxItem Content="All Categories" IsSelected="True"/>
                        <ComboBoxItem Content="technology"/>
                        <ComboBoxItem Content="adventure"/>
                        <ComboBoxItem Content="magic"/>
                        <ComboBoxItem Content="storage"/>
                        <ComboBoxItem Content="utility"/>
                        <ComboBoxItem Content="decoration"/>
                        <ComboBoxItem Content="worldgen"/>
                        <ComboBoxItem Content="equipment"/>
                        <ComboBoxItem Content="food"/>
                    </ComboBox>

                    <!-- Version Filter -->
                    <TextBlock Text="Minecraft Version:" Margin="0,0,0,5"/>
                    <ComboBox x:Name="VersionFilter" Height="30" Margin="0,0,0,10">
                        <ComboBoxItem Content="All Versions" IsSelected="True"/>
                        <ComboBoxItem Content="1.21.8"/>
                        <ComboBoxItem Content="1.21.7"/>
                        <ComboBoxItem Content="1.21.6"/>
                        <ComboBoxItem Content="1.21.5"/>
                        <ComboBoxItem Content="1.21.4"/>
                        <ComboBoxItem Content="1.21.3"/>
                        <ComboBoxItem Content="1.21.2"/>
                        <ComboBoxItem Content="1.21.1"/>
                        <ComboBoxItem Content="1.21"/>
                        <ComboBoxItem Content="1.20.4"/>
                        <ComboBoxItem Content="1.20.1"/>
                        <ComboBoxItem Content="1.19.4"/>
                        <ComboBoxItem Content="1.19.2"/>
                    </ComboBox>

                    <!-- Loader Filter -->
                    <TextBlock Text="Mod Loader:" Margin="0,0,0,5"/>
                    <ComboBox x:Name="LoaderFilter" Height="30" Margin="0,0,0,10">
                        <ComboBoxItem Content="All Loaders" IsSelected="True"/>
                        <ComboBoxItem Content="fabric"/>
                        <ComboBoxItem Content="forge"/>
                        <ComboBoxItem Content="quilt"/>
                        <ComboBoxItem Content="neoforge"/>
                    </ComboBox>

                    <!-- Sort By -->
                    <TextBlock Text="Sort By:" Margin="0,0,0,5"/>
                    <ComboBox x:Name="SortFilter" Height="30" Margin="0,0,0,15">
                        <ComboBoxItem Content="Relevance" Tag="relevance" IsSelected="True"/>
                        <ComboBoxItem Content="Downloads" Tag="downloads"/>
                        <ComboBoxItem Content="Follows" Tag="follows"/>
                        <ComboBoxItem Content="Updated" Tag="updated"/>
                        <ComboBoxItem Content="Newest" Tag="newest"/>
                    </ComboBox>

                    <!-- Search Button -->
                    <Button x:Name="SearchButton" Content="Search Mods" 
                            Click="SearchMods_Click"
                            Style="{StaticResource SuccessButtonStyle}"/>

                    <!-- Quick Actions -->
                    <Separator Margin="0,15"/>
                    <Button Content="Popular Mods" Height="30" Margin="0,0,0,5" 
                            Click="LoadPopularMods_Click"/>
                    <Button Content="Technology Mods" Height="30" Margin="0,0,0,5" 
                            Click="LoadTechMods_Click"/>
                    <Button Content="Magic Mods" Height="30" 
                            Click="LoadMagicMods_Click"/>
                </StackPanel>
            </Border>

            <!-- Right Panel - Mod Results -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Results Header -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                    <TextBlock x:Name="ResultsCount" Text="Search for mods above" 
                               FontSize="14" VerticalAlignment="Center"/>
                    <TextBlock x:Name="LoadingText" Text="Loading..." 
                               FontSize="14" VerticalAlignment="Center" 
                               Foreground="Blue" Visibility="Collapsed" Margin="10,0"/>
                </StackPanel>

                <!-- Results List -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <ItemsControl x:Name="ModsList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="White" BorderBrush="#e0e0e0" 
                                        BorderThickness="1" Margin="0,0,0,10" 
                                        Padding="15" CornerRadius="5">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="60"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Mod Icon -->
                                        <Border Grid.Column="0" Width="50" Height="50" 
                                                Background="#f0f0f0" CornerRadius="5">
                                            <Image Source="{Binding IconUrl}" 
                                                   Stretch="UniformToFill"/>
                                        </Border>

                                        <!-- Mod Info -->
                                        <StackPanel Grid.Column="1" Margin="15,0">
                                            <TextBlock Text="{Binding Title}" 
                                                       FontSize="16" FontWeight="Bold"/>
                                            <TextBlock Text="{Binding Author}" 
                                                       FontSize="12" Foreground="Gray" 
                                                       Margin="0,2,0,5"/>
                                            <TextBlock Text="{Binding Description}" 
                                                       FontSize="12" TextWrapping="Wrap" 
                                                       MaxHeight="40"/>
                                            <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                                <TextBlock Text="{Binding Downloads, StringFormat='{}{0:N0} downloads'}" 
                                                           FontSize="11" Foreground="Green" 
                                                           Margin="0,0,15,0"/>
                                                <TextBlock Text="{Binding Follows, StringFormat='{}{0:N0} followers'}" 
                                                           FontSize="11" Foreground="Blue"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Download Button -->
                                        <Button Grid.Column="2" Content="Download" 
                                                Width="80" Height="30"
                                                Click="DownloadMod_Click"
                                                Tag="{Binding}"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Pagination Controls -->
                <Border Grid.Row="2" Background="#f8f9fa" Padding="15" Margin="0,10,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Previous/Next Buttons -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <Button x:Name="FirstPageButton" Content="⏮" Width="35" Height="30" 
                                    Click="FirstPage_Click" Margin="0,0,5,0" 
                                    ToolTip="First Page"/>
                            <Button x:Name="PreviousPageButton" Content="◀" Width="35" Height="30" 
                                    Click="PreviousPage_Click" Margin="0,0,5,0"
                                    ToolTip="Previous Page"/>
                        </StackPanel>

                        <!-- Page Info -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" 
                                    HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="Page " VerticalAlignment="Center"/>
                            <TextBox x:Name="CurrentPageTextBox" Width="50" Height="25" 
                                     TextAlignment="Center" VerticalAlignment="Center"
                                     KeyDown="PageTextBox_KeyDown"/>
                            <TextBlock x:Name="TotalPagesText" Text=" of 1" VerticalAlignment="Center" Margin="5,0"/>
                            <TextBlock x:Name="ItemsRangeText" Text="(1-20 of 0 items)" 
                                       VerticalAlignment="Center" Margin="10,0,0,0" 
                                       FontSize="11" Foreground="Gray"/>
                        </StackPanel>

                        <!-- Next/Last Buttons -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                            <Button x:Name="NextPageButton" Content="▶" Width="35" Height="30" 
                                    Click="NextPage_Click" Margin="5,0,0,0"
                                    ToolTip="Next Page"/>
                            <Button x:Name="LastPageButton" Content="⏭" Width="35" Height="30" 
                                    Click="LastPage_Click" Margin="5,0,0,0"
                                    ToolTip="Last Page"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</Page>